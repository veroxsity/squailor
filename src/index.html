<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: blob:; font-src 'self' https://fonts.gstatic.com data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self'; connect-src 'self' https://*.openrouter.ai https://api.openai.com https://api.anthropic.com https://generativelanguage.googleapis.com https://api.cohere.ai https://api.groq.com https://api.mistral.ai https://api.x.ai https://*.openai.azure.com https://*.azure.com https://*.azureedge.net https://github.com https://raw.githubusercontent.com https://objects.githubusercontent.com https://fonts.googleapis.com https://fonts.gstatic.com http://localhost:* http://127.0.0.1:* https://localhost:* https://127.0.0.1:*; frame-ancestors 'self';">
  <title>Squailor - AI Document Summarizer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/index.css">
  <script defer src="./renderer/bootstrap.js"></script>
</head>
<body>
  <a href="#mainContent" class="skip-link">Skip to main content</a>
  <div class="background-animation" aria-hidden="true">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="app-shell">
    <aside class="app-rail">
      <div class="rail-top">
        <button class="rail-logo" data-page="home" aria-label="Squailor home">
          <svg width="40" height="40" viewBox="0 0 48 48" fill="none">
            <rect width="48" height="48" rx="12" fill="url(#railGradient)" />
            <path d="M14 18h20M14 24h20M14 30h14" stroke="white" stroke-width="2.5" stroke-linecap="round" />
            <defs>
              <linearGradient id="railGradient" x1="0" y1="0" x2="48" y2="48">
                <stop offset="0%" stop-color="#667eea" />
                <stop offset="100%" stop-color="#764ba2" />
              </linearGradient>
            </defs>
          </svg>
        </button>
        <nav class="rail-nav" aria-label="Primary">
          <button class="rail-item" title="Workspace" aria-label="Workspace" data-page="workspace">
            <span class="rail-icon" aria-hidden="true">üìù</span>
            <span class="rail-label">Workspace</span>
          </button>
          <button class="rail-item" title="History" aria-label="History" data-page="history">
            <span class="rail-icon" aria-hidden="true">üïë</span>
            <span class="rail-label">History</span>
          </button>
          <button class="rail-item" title="Settings" aria-label="Settings" data-page="settings">
            <span class="rail-icon" aria-hidden="true">‚öôÔ∏è</span>
            <span class="rail-label">Settings</span>
          </button>
        </nav>
      </div>
      <div class="rail-bottom">
        <div class="rail-meta">
          <div class="rail-app">Squailor</div>
          <div id="appVersionDisplayRail" class="rail-version">v‚Äî</div>
        </div>
        <button class="rail-help" title="About" aria-label="About" data-page="settings" data-panel="about">
          <span class="rail-icon" aria-hidden="true">‚ùì</span>
          <span class="rail-label">About</span>
        </button>
      </div>
    </aside>

    <div class="app-main">
      <header class="app-header">
        <div class="header-title stack-sm">
          <h1 id="appHeading">Welcome to Squailor</h1>
          <p id="appSubtitle">AI-powered document summarization made simple</p>
        </div>
        <div class="header-actions cluster">
          <button class="btn btn-ghost" id="openSettingsAppearance">üé® Theme</button>
        </div>
      </header>

      <main id="mainContent" class="app-content" tabindex="-1">
        <div class="app-pages stack-lg">
          
        <!-- WORKSPACE PAGE (New Unified Page) -->
        <section id="workspacePage" class="page page-active" aria-labelledby="workspaceHeading">
          
          <!-- Compact Header -->
          <div class="workspace-header">
            <div class="workspace-header-content">
              <div class="workspace-badge">
                <span>‚ú®</span>
                <span>AI-Powered Summarization</span>
              </div>
              <h2 id="workspaceHeading" class="workspace-title">
                Transform Documents into <span class="gradient-text">Insights</span>
              </h2>
            </div>
            <div id="workspaceProviderAlert" class="workspace-alert" hidden>
              <span class="alert-icon">ÔøΩ</span>
              <span class="alert-text">API key required</span>
              <button class="btn btn-small btn-primary" data-page="settings" data-panel="models">Add Key</button>
            </div>
          </div>

          <div class="workspace-layout">
            
            <!-- Main Column: Upload, Options & Queue -->
            <div class="workspace-main">
              
              <!-- Summary Options Card -->
              <div class="options-card">
                <h3 class="options-title">Summary Options</h3>

                <!-- AI Model -->
                <div class="option-group">
                  <label class="option-label">
                    <span class="option-icon">ü§ñ</span>
                    <span>AI Model</span>
                  </label>
                  <select id="modelSelect" class="select">
                    <option value="">Loading models...</option>
                  </select>
                </div>

                <!-- Length -->
                <div class="option-group">
                  <label class="option-label">
                    <span class="option-icon">üìä</span>
                    <span>Length</span>
                  </label>
                  <div class="radio-group">
                    <div class="radio-pill">
                      <input type="radio" name="summaryType" value="short" id="modeShort">
                      <label for="modeShort">Short</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="summaryType" value="normal" id="modeNormal" checked>
                      <label for="modeNormal">Normal</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="summaryType" value="longer" id="modeLonger">
                      <label for="modeLonger">Detailed</label>
                    </div>
                  </div>
                </div>

                <!-- Tone -->
                <div class="option-group">
                  <label class="option-label">
                    <span class="option-icon">üéØ</span>
                    <span>Tone</span>
                  </label>
                  <div class="radio-group">
                    <div class="radio-pill">
                      <input type="radio" name="responseTone" value="casual" id="toneCasual" checked>
                      <label for="toneCasual">Casual</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="responseTone" value="formal" id="toneFormal">
                      <label for="toneFormal">Formal</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="responseTone" value="informative" id="toneInformative">
                      <label for="toneInformative">Info</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="responseTone" value="eli5" id="toneEli5">
                      <label for="toneEli5">ELI5</label>
                    </div>
                  </div>
                </div>

                <!-- Style -->
                <div class="option-group">
                  <label class="option-label">
                    <span class="option-icon">üìù</span>
                    <span>Style</span>
                  </label>
                  <div class="radio-group">
                    <div class="radio-pill">
                      <input type="radio" name="summaryStyle" value="teaching" id="styleTeaching" checked>
                      <label for="styleTeaching">Teaching</label>
                    </div>
                    <div class="radio-pill">
                      <input type="radio" name="summaryStyle" value="notes" id="styleNotes">
                      <label for="styleNotes">Notes</label>
                    </div>
                  </div>
                </div>

                <!-- Advanced Options -->
                <div class="option-group">
                  <label class="option-label">
                    <span class="option-icon">‚öôÔ∏è</span>
                    <span>Advanced</span>
                  </label>
                  <div class="toggle-list">
                    <div class="toggle-switch">
                      <input type="checkbox" id="processImagesToggle" checked>
                      <label for="processImagesToggle" class="toggle-switch-label">
                        <span class="toggle-title">Process Images (OCR)</span>
                        <span class="toggle-desc">Extract text from images in PDFs</span>
                      </label>
                    </div>
                    <div class="toggle-switch">
                      <input type="checkbox" id="combineFilesToggle">
                      <label for="combineFilesToggle" class="toggle-switch-label">
                        <span class="toggle-title">Combine Files</span>
                        <span class="toggle-desc">Generate one summary for all files</span>
                      </label>
                    </div>
                  </div>
                </div>

              </div>

              <!-- File Upload Card -->
              <div class="upload-card-modern">
                <div id="dropzone" class="dropzone-compact">
                  <div class="dropzone-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                  </div>
                  <div class="dropzone-text">
                    <h3>Drop files or click to upload</h3>
                    <p>Supports PDF, DOCX, PPTX files</p>
                  </div>
                  <button id="openFile" class="btn btn-primary">
                    <span class="btn-icon">üìÇ</span>
                    <span>Browse Files</span>
                  </button>
                </div>
              </div>

              <!-- File List -->
              <div id="fileListContainer" class="file-queue-card" hidden>
                <div class="file-queue-header">
                  <div>
                    <h3>Processing Queue</h3>
                    <p id="queueCount" class="queue-count">0 files ready</p>
                  </div>
                  <button id="clearFileList" class="btn btn-ghost btn-small">Clear All</button>
                </div>
                <div id="fileList" class="file-queue-list">
                  <!-- File items dynamically added -->
                </div>
              </div>

              <!-- Custom Prompt -->
              <div id="processingOptions" class="custom-prompt-card" hidden>
                <div class="form-group">
                  <label for="customPrompt" class="form-label">
                    <span>Custom Instructions (Optional)</span>
                    <span class="form-label-hint">Tailor the summary to your needs</span>
                  </label>
                  <div class="input-with-button">
                    <textarea id="customPrompt" class="textarea" rows="3" placeholder="e.g., Summarize this for a 5th grader, focus on key takeaways..."></textarea>
                    <button id="clearCustomPrompt" class="icon-btn" title="Clear">‚úï</button>
                  </div>
                </div>
              </div>

              <!-- Process Button -->
              <div id="processButtonContainer" class="process-action" hidden>
                <button id="processFiles" class="btn btn-success btn-large btn-block" disabled>
                  <span class="btn-icon">üöÄ</span>
                  <span>Generate Summaries</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Results Section (hidden by default) -->
          <section id="resultsSection" class="results-section" aria-live="polite" hidden>
            <header class="results-header">
              <h3>‚ú® Summary results</h3>
              <p>Review, share, or export your generated summaries.</p>
            </header>
            <div id="results" class="results-grid"></div>
          </section>
        </section>

        <!-- HISTORY PAGE -->
        <section id="historyPage" class="page" aria-labelledby="historyTitle" hidden>
          <div class="page-heading">
            <div>
              <h2 id="historyTitle">Summary history</h2>
              <p class="page-subtitle">Search, filter, and revisit previous summaries.</p>
            </div>
            <div class="page-meta">
              <span class="meta-chip" id="totalSummaries">0 summaries</span>
              <span class="meta-chip" id="totalDocuments">0 documents</span>
            </div>
          </div>

          <div class="history-layout">
            <aside class="history-sidebar" aria-label="History filters">
              <div class="history-card">
                <label class="form-label" for="historySearch">Search</label>
                <input id="historySearch" class="modern-input" type="search" placeholder="Search summaries..." autocomplete="off">
              </div>
              <div class="history-card">
                <div class="history-card-header">
                  <h4>Quick filters</h4>
                  <button id="clearHistory" class="btn btn-ghost btn-small">Clear all</button>
                </div>
                <div class="filter-chips" id="historyFilters"></div>
              </div>
              <div class="history-card">
                <h4>Summary types</h4>
                <div class="filter-list" id="historyTypes"></div>
              </div>
              <div class="history-card">
                <h4>Tones & styles</h4>
                <div class="filter-list" id="historyTones"></div>
              </div>
            </aside>

            <div class="history-feed">
              <div id="historyList" class="history-list" aria-live="polite"></div>
              <div id="emptyHistory" class="empty-state" hidden>
                <div class="empty-illustration">üìù</div>
                <h3>No history yet</h3>
                <p>Upload a document on the home workspace to get started.</p>
                <button class="btn btn-outline" data-page="home">Go to workspace</button>
              </div>
            </div>
          </div>
        </section>

  <section id="summaryViewPage" class="page" aria-labelledby="summaryViewHeading" hidden>
          <div class="page-heading">
            <div>
              <button class="btn btn-ghost back-button" id="backFromSummary">‚Üê Back</button>
              <h2 id="summaryViewHeading">Summary</h2>
              <p id="summaryViewMeta" class="page-subtitle">Loading...</p>
            </div>
            <div class="summary-meta-chips" id="summaryMetaChips"></div>
          </div>

          <div class="summary-workspace" id="summarySplit">
            <aside class="workspace-panel toc-panel" id="tocSidebar" hidden>
              <div class="panel-header">
                <h3>Outline</h3>
                <button class="icon-btn" id="tocCloseBtn" title="Close outline">‚úñÔ∏è</button>
              </div>
              <div class="panel-body">
                <input id="tocFilter" class="modern-input" type="text" placeholder="Filter sections..." autocomplete="off">
                <nav id="tocList" class="toc-list"></nav>
              </div>
            </aside>

            <div class="panel-resizer" id="tocResizer" hidden></div>

            <article class="workspace-panel summary-panel">
              <header class="summary-panel-header">
                <div class="summary-view-info">
                  <div class="summary-view-icon">‚ú®</div>
                  <div>
                    <h3>AI generated summary</h3>
                    <p id="summaryViewStats">Loading...</p>
                  </div>
                </div>
                <div class="summary-quick-actions">
                  <button class="btn btn-ghost" id="openTocBtn" aria-controls="tocSidebar" aria-expanded="false">‚ò∞ Outline</button>
                  <button class="btn btn-outline btn-small" id="copySummaryView">Copy</button>
                  <button class="btn btn-outline btn-small" id="exportSummaryMD">Export MD</button>
                  <button class="btn btn-outline btn-small" id="exportSummaryTXT">Export TXT</button>
                  <button class="btn btn-outline btn-small" id="shareSummaryView">Share</button>
                  <button class="btn btn-primary btn-small" id="openQaBtn" aria-controls="qaSidebar" aria-expanded="false">üí¨ Ask AI</button>
                </div>
              </header>
              <div class="summary-panel-body">
                <div class="markdown-content" id="summaryViewContent">
                  <div class="viewer-loading">Loading summary...</div>
                </div>
              </div>
            </article>

            <div class="panel-resizer" id="qaResizer" hidden></div>

            <aside class="workspace-panel qa-panel" id="qaSidebar" hidden>
              <div class="panel-header">
                <h3>Chat about this summary</h3>
                <button class="icon-btn" id="qaCloseBtn" title="Close chat">‚úñÔ∏è</button>
              </div>
              <div id="qaTranscript" class="qa-transcript"></div>
              <div class="qa-input-row">
                <input id="qaInput" class="modern-input" type="text" placeholder="Ask a question about the summary..." autocomplete="off">
                <button id="qaSendBtn" class="btn btn-primary">Ask</button>
              </div>
              <div id="qaStatus" class="status-message" hidden role="status" aria-live="polite"></div>
              <div class="panel-resizer qa-edge" id="qaResizerRight"></div>
            </aside>
          </div>
        </section>

  <section id="settingsPage" class="page" aria-labelledby="settingsHeading" hidden>
          <div class="settings-layout">
            <aside class="settings-sidebar" aria-label="Settings navigation">
              <div class="settings-profile">
                <div class="avatar">SQ</div>
                <div class="profile-meta">
                  <strong>Squailor</strong>
                  <span>AI Summarizer</span>
                </div>
              </div>
              <nav class="settings-nav" role="tablist" aria-label="Settings sections">
                <p class="nav-group">App</p>
                <button id="tab-models" class="settings-nav-item active" data-panel="models" role="tab" aria-selected="true" aria-controls="panel-models">ü§ñ AI Providers</button>
                <button id="tab-image" class="settings-nav-item" data-panel="image" role="tab" aria-selected="false" aria-controls="panel-image" tabindex="-1">üñºÔ∏è Image Settings</button>
                <button id="tab-appearance" class="settings-nav-item" data-panel="appearance" role="tab" aria-selected="false" aria-controls="panel-appearance" tabindex="-1">üé® Appearance</button>
                <button id="tab-storage" class="settings-nav-item" data-panel="storage" role="tab" aria-selected="false" aria-controls="panel-storage" tabindex="-1">üíæ Storage</button>
                <button id="tab-updates" class="settings-nav-item" data-panel="updates" role="tab" aria-selected="false" aria-controls="panel-updates" tabindex="-1">‚¨ÜÔ∏è Updates <span id="updateReadyBadge" class="meta-badge" style="display:none; margin-left:6px;">Update ready</span></button>
                <button id="tab-about" class="settings-nav-item" data-panel="about" role="tab" aria-selected="false" aria-controls="panel-about" tabindex="-1">‚ÑπÔ∏è About</button>
                <p class="nav-group">Privacy</p>
                <button id="tab-privacy" class="settings-nav-item" data-panel="privacy" role="tab" aria-selected="false" aria-controls="panel-privacy" tabindex="-1">üîí Privacy</button>
              </nav>
            </aside>

            <section class="settings-content">
              <header class="settings-content-header">
                <div>
                  <h2 id="settingsSectionTitle">AI Providers</h2>
                  <p id="settingsSectionSubtitle">Configure your AI provider credentials.</p>
                </div>
                <div class="settings-actions">
                  <button id="settingsHeaderAction" class="btn btn-primary" hidden></button>
                </div>
              </header>

              <div class="settings-panels" id="settingsPanels">
                <div id="panel-models" class="settings-panel active" role="tabpanel" aria-labelledby="tab-models">
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">ü§ñ</div>
                      <div>
                        <h3>AI provider configuration</h3>
                        <p>Choose your AI provider and configure API credentials.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="form-group">
                        <label class="form-label" for="providerSelect">AI provider</label>
                        <select id="providerSelect" class="modern-select">
                          <option value="openrouter">OpenRouter</option>
                          <option value="openai">OpenAI</option>
                          <option value="anthropic">Anthropic</option>
                          <option value="google">Google (Gemini)</option>
                          <option value="cohere">Cohere</option>
                          <option value="groq">Groq</option>
                          <option value="mistral">Mistral</option>
                          <option value="xai">xAI</option>
                          <option value="azure-openai">Azure OpenAI</option>
                          <option value="custom-openai">Custom OpenAI-compatible</option>
                        </select>
                        <p class="form-helper">Provider settings here apply across the app.</p>
                      </div>

                      <div class="form-group">
                        <label class="form-label" for="providerApiKey">API key</label>
                        <div class="input-with-button">
                          <input type="password" id="providerApiKey" class="modern-input" placeholder="Enter API key..." autocomplete="off">
                          <button id="toggleProviderKey" class="icon-button" title="Show or hide API key">üëÅÔ∏è</button>
                        </div>
                        <p class="form-helper" id="providerKeyHelper">Your key is encrypted locally. Leave blank to keep your saved key.</p>
                      </div>

                      <div class="form-group" id="providerConfigFields">
                        <!-- Provider-specific fields will render here -->
                      </div>

                      <div class="button-row">
                        <button id="testProviderBtn" class="btn btn-outline">Test connection</button>
                        <button id="saveProviderBtn" class="btn btn-primary">Save settings</button>
                        <button id="deleteProviderKeyBtn" class="btn btn-ghost">Delete saved key</button>
                      </div>
                      <div id="providerKeyStatus" class="status-message" style="margin-top: 8px;" role="status" aria-live="polite"></div>
                    </div>
                  </article>
                </div>

                <div id="panel-image" class="settings-panel" role="tabpanel" aria-labelledby="tab-image" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üñºÔ∏è</div>
                      <div>
                        <h3>Image handling</h3>
                        <p>Control OCR usage and combined summary limits.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="form-group">
                        <label for="maxImagesInput" class="form-label">Max images per document</label>
                        <input type="number" id="maxImagesInput" class="modern-input" min="0" max="10">
                        <p class="form-helper">Lower this to reduce API calls and processing cost.</p>
                      </div>
                      <div class="form-group">
                        <label for="maxCombinedInput" class="form-label">Max files to combine</label>
                        <input type="number" id="maxCombinedInput" class="modern-input" min="1" max="10">
                        <p class="form-helper">Caps how many files run when "Combine" is enabled.</p>
                      </div>
                      <button id="saveMaxImages" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        <span>Save settings</span>
                      </button>
                      <div id="maxImagesStatus" class="status-message" role="status" aria-live="polite"></div>
                    </div>
                  </article>
                </div>

                <div id="panel-appearance" class="settings-panel" role="tabpanel" aria-labelledby="tab-appearance" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üé®</div>
                      <div>
                        <h3>Appearance</h3>
                        <p>Switch between system, dark, light, or high contrast themes.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="theme-selector">
                        <button class="theme-option" data-theme="system">
                          <div class="theme-preview light"></div>
                          <span>System</span>
                        </button>
                        <button class="theme-option" data-theme="dark">
                          <div class="theme-preview dark"></div>
                          <span>Dark</span>
                        </button>
                        <button class="theme-option" data-theme="light">
                          <div class="theme-preview light"></div>
                          <span>Light</span>
                        </button>
                        <button class="theme-option" data-theme="high-contrast">
                          <div class="theme-preview high-contrast"></div>
                          <span>High Contrast</span>
                        </button>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-storage" class="settings-panel" role="tabpanel" aria-labelledby="tab-storage" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üíæ</div>
                      <div>
                        <h3>Storage location</h3>
                        <p>Choose where Squailor stores your documents.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="storage-options">
                        <label class="storage-option">
                          <input type="radio" name="storageLocation" value="appdata" id="storageAppData" checked>
                          <div class="storage-content">
                            <div class="storage-icon">üìÅ</div>
                            <div>
                              <strong>AppData (default)</strong>
                              <span id="appdataPath">Loading...</span>
                            </div>
                          </div>
                        </label>
                        <label class="storage-option">
                          <input type="radio" name="storageLocation" value="local-app" id="storageLocalApp">
                          <div class="storage-content">
                            <div class="storage-icon">üìÇ</div>
                            <div>
                              <strong>Application folder</strong>
                              <span id="localAppPath">Loading...</span>
                            </div>
                          </div>
                        </label>
                      </div>
                      <button id="saveStorageLocation" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        <span>Apply location</span>
                      </button>
                      <div id="storageStatus" class="status-message" role="status" aria-live="polite"></div>
                      <div class="storage-stats">
                        <div><span>Files stored:</span> <strong id="statsFileCount">0</strong></div>
                        <div><span>Total size:</span> <strong id="statsTotalSize">0 MB</strong></div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-updates" class="settings-panel" role="tabpanel" aria-labelledby="tab-updates" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">‚¨ÜÔ∏è</div>
                      <div>
                        <h3>Updates</h3>
                        <p>Manage application updates and installation behavior.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="update-actions">
                        <button id="checkUpdatesBtn" class="btn btn-primary">Check for updates</button>
                        <button id="installUpdateBtn" class="btn btn-success" hidden>Restart & install</button>
                        <button id="applyOnRestartBtn" class="btn btn-outline" hidden>Apply on restart</button>
                        <span id="updateStatus" class="status-inline" role="status" aria-live="polite"></span>
                      </div>
                      <div class="update-info" style="margin-top:12px;display:grid;gap:6px;font-size:13px;">
                        <div><strong>Current version:</strong> <span id="currentVersionValue">Loading...</span></div>
                        <div><strong>Latest available:</strong> <span id="latestVersionValue">‚Äî</span></div>
                        <div class="form-group">
                          <label class="form-label" for="updateProviderSelect">Update source</label>
                          <select id="updateProviderSelect" class="modern-select">
                            <option value="github">GitHub (default)</option>
                            <option value="generic">Custom URL (CDN)</option>
                          </select>
                        </div>
                        <div class="form-group" id="genericUrlRow" style="display:none;">
                          <label class="form-label" for="updateGenericUrlInput">Custom update base URL</label>
                          <input id="updateGenericUrlInput" class="modern-input" type="url" placeholder="https://cdn.example.com/squailor">
                          <p class="form-helper">Point to a directory containing latest.yml and release files.</p>
                        </div>
                        <label class="setting-toggle" style="display:flex;align-items:center;gap:6px;margin-top:4px;">
                          <input type="checkbox" id="autoApplyUpdatesToggle">
                          <span>Auto-apply downloaded updates</span>
                        </label>
                        <div id="updateProgressDetails" style="color:#64748b;min-height:16px;font-size:12px;"></div>
                        <div class="manual-download-row" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;">
                          <button id="manualDownloadBtn" class="btn btn-outline btn-small">Manual download</button>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-about" class="settings-panel" role="tabpanel" aria-labelledby="tab-about" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">‚ÑπÔ∏è</div>
                      <div>
                        <h3>About Squailor</h3>
                        <p>Version details and quick links.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <p>Squailor turns lengthy lectures and PDFs into digestible study material powered by OpenRouter.</p>
                      <div class="info-box">
                        <div class="info-icon">üì¶</div>
                        <div class="info-content">
                          <strong>Current version</strong>
                          <p id="appVersionDisplay">Loading...</p>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-privacy" class="settings-panel" role="tabpanel" aria-labelledby="tab-privacy" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üîí</div>
                      <div>
                        <h3>Privacy</h3>
                        <p>Understand how your data is handled.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="info-box">
                        <div class="info-icon">‚ÑπÔ∏è</div>
                        <div class="info-content">
                          <strong>Local-first promise</strong>
                          <ul>
                            <li>Documents stay on disk in the storage location you choose.</li>
                            <li>API keys are encrypted at rest and can be cleared anytime.</li>
                            <li>Only necessary excerpts are sent to the selected model via OpenRouter.</li>
                          </ul>
                        </div>
                      </div>
                      <hr style="border:none;border-top:1px solid #1f2937;margin:16px 0;opacity:.5;" />
                      <div class="info-box">
                        <div class="info-icon">üß≠</div>
                        <div class="info-content" style="width:100%">
                          <strong>Network diagnostics</strong>
                          <p>Hosts contacted outside the known allowlist are shown here to help identify unexpected network activity.</p>
                          <div class="button-row" style="margin:8px 0;gap:8px;display:flex;flex-wrap:wrap;">
                            <button id="diagRefreshBtn" class="btn btn-outline btn-small">Refresh</button>
                            <button id="diagExportBtn" class="btn btn-outline btn-small">Export</button>
                            <button id="diagClearBtn" class="btn btn-ghost btn-small">Clear</button>
                            <span id="diagCount" class="status-inline"></span>
                          </div>
                          <div id="diagList" class="diagnostics-list" style="max-height:180px;overflow:auto;border:1px solid #1f2937;padding:8px;border-radius:8px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:12px;"></div>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>
              </div>
            </section>
          </div>
        </section>
        </div>
      </main>
    </div>
  </div>

  <div id="summaryCompleteModal" class="modal" hidden>
    <div class="modal-overlay" role="presentation"></div>
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="summaryModalHeading">
      <header class="modal-header">
  <h2 id="summaryModalHeading">‚ú® Generated summaries</h2>
  <button class="modal-close" data-action="close-summary-modal" aria-label="Close dialog">√ó</button>
      </header>
      <div class="modal-body">
        <p class="modal-description">Your document summaries are ready. Review each card to open the full view.</p>
        <div id="summaryCards" class="summary-cards-grid"></div>
      </div>
      <footer class="modal-footer">
  <button class="btn btn-outline" data-action="close-summary-modal">Close</button>
      </footer>
    </div>
  </div>

  <div id="confirmModal" class="modal" hidden>
    <div class="modal-overlay" role="presentation"></div>
    <div class="modal-content small" role="dialog" aria-modal="true" aria-labelledby="confirmModalBody">
      <div class="modal-body" id="confirmModalBody">Are you sure?</div>
      <div class="modal-message" id="confirmMessage"></div>
      <footer class="modal-footer">
        <button id="confirmCancelBtn" class="btn btn-outline">Cancel</button>
        <button id="confirmOkBtn" class="btn btn-success">Confirm</button>
      </footer>
    </div>
  </div>

  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: blob:; font-src 'self' https://fonts.gstatic.com data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self'; connect-src 'self' https://*.openrouter.ai https://api.openai.com https://api.anthropic.com https://generativelanguage.googleapis.com https://api.cohere.ai https://api.groq.com https://api.mistral.ai https://api.x.ai https://*.openai.azure.com https://*.azure.com https://*.azureedge.net https://github.com https://raw.githubusercontent.com https://objects.githubusercontent.com https://fonts.googleapis.com https://fonts.gstatic.com http://localhost:* http://127.0.0.1:* https://localhost:* https://127.0.0.1:*; frame-ancestors 'self';">
  <title>Squailor - AI Document Summarizer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="#mainContent" class="skip-link">Skip to main content</a>
  <div class="background-animation" aria-hidden="true">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <div class="app-shell">
    <aside class="app-rail">
      <div class="rail-top">
        <button class="rail-logo" data-page="home" aria-label="Squailor home">
          <svg width="40" height="40" viewBox="0 0 48 48" fill="none">
            <rect width="48" height="48" rx="12" fill="url(#railGradient)" />
            <path d="M14 18h20M14 24h20M14 30h14" stroke="white" stroke-width="2.5" stroke-linecap="round" />
            <defs>
              <linearGradient id="railGradient" x1="0" y1="0" x2="48" y2="48">
                <stop offset="0%" stop-color="#667eea" />
                <stop offset="100%" stop-color="#764ba2" />
              </linearGradient>
            </defs>
          </svg>
        </button>
        <nav class="rail-nav" aria-label="Primary">
          <button class="rail-item active" data-page="home">
            <span class="rail-icon">üè†</span>
            <span class="rail-label">Home</span>
          </button>
          <button class="rail-item" data-page="history">
            <span class="rail-icon">üïë</span>
            <span class="rail-label">History</span>
          </button>
          <button class="rail-item" data-page="settings">
            <span class="rail-icon">‚öôÔ∏è</span>
            <span class="rail-label">Settings</span>
          </button>
        </nav>
      </div>
      <div class="rail-bottom">
        <div class="rail-meta">
          <div class="rail-app">Squailor</div>
          <div id="appVersionDisplayRail" class="rail-version">v‚Äî</div>
        </div>
        <button class="rail-help" data-page="settings" data-panel="about">
          <span class="rail-icon">‚ùì</span>
          <span class="rail-label">About</span>
        </button>
      </div>
    </aside>

    <div class="app-main">
      <header class="app-header">
        <div class="header-title stack-sm">
          <h1 id="appHeading">Document workspace</h1>
          <p id="appSubtitle">Transform your documents into concise, intelligent summaries</p>
        </div>
        <div class="header-actions cluster">
          <button class="btn btn-ghost" id="openSettingsAppearance">üé® Theme</button>
          <button class="btn btn-outline" id="headerHistoryShortcut" data-page="history">
            <span class="btn-icon">üïë</span>
            <span>History</span>
          </button>
        </div>
        <div class="status-strip" role="status" aria-live="polite">
          <div class="status-chip">
            <div class="status-chip-heading">
              <span class="status-chip-icon">üîå</span>
              <span class="status-chip-label">Provider</span>
            </div>
            <div class="status-chip-value" id="statusProviderValue">Loading‚Ä¶</div>
            <div class="status-chip-meta" id="statusProviderMeta" data-state="warn">Checking key‚Ä¶</div>
            <div class="status-chip-actions">
              <button class="status-chip-link" data-page="settings" data-panel="models">Manage</button>
            </div>
          </div>
          <div class="status-chip">
            <div class="status-chip-heading">
              <span class="status-chip-icon">üìÇ</span>
              <span class="status-chip-label">Queue</span>
            </div>
            <div class="status-chip-value" id="statusQueueValue">0 files</div>
            <div class="status-chip-meta" id="statusQueueMeta" data-state="idle">Queue idle</div>
            <div class="status-chip-actions">
              <button class="status-chip-link" data-page="history">Open history</button>
            </div>
          </div>
          <div class="status-chip">
            <div class="status-chip-heading">
              <span class="status-chip-icon">üåê</span>
              <span class="status-chip-label">Network</span>
            </div>
            <div class="status-chip-value" id="statusNetworkValue">Detecting‚Ä¶</div>
            <div class="status-chip-meta" id="statusNetworkMeta" data-state="idle">Checking status</div>
          </div>
        </div>
      </header>

      <main id="mainContent" class="app-content" tabindex="-1">
        <div class="app-pages stack-lg">
          <!-- ...existing content replaced with redesigned sections... -->
        <section id="homePage" class="page page-active stack-lg" aria-labelledby="homeTitle">
          <div class="home-hero surface-raised stack-md">
            <div class="hero-content stack-sm">
              <div class="inline-meta">
                <span class="status-pill info">Workspace</span>
                <span class="status-pill success" id="homeProviderBadge">Provider: Loading‚Ä¶</span>
              </div>
              <div class="stack-xs">
                <h1 id="homeTitle" class="text-display">Transform documents into insights</h1>
                <p class="text-secondary">Upload PDFs, PPTX, and DOCX files, then tailor length, tone, and format to generate summaries that match your voice.</p>
              </div>
              <div id="heroProviderAlert" class="hero-alert" hidden>
                <div class="hero-alert-text">
                  <strong>API key required</strong>
                  <span>Add an AI provider key to start summarizing documents.</span>
                </div>
                <button id="heroProviderCta" class="btn btn-outline" data-page="settings" data-panel="models">Add API key</button>
              </div>
              <div class="hero-chips inline-scroll" aria-label="Key benefits">
                <span class="chip">‚ö° Real-time streaming</span>
                <span class="chip">üéØ Custom tones</span>
                <span class="chip">üìä Combined files</span>
                <span class="chip">üõ°Ô∏è Local-first privacy</span>
                <span class="chip">üîê Secure storage</span>
              </div>
              <div class="hero-stats cluster cluster-nowrap" role="list">
                <div class="stat-card" role="listitem">
                  <span class="stat-label">Summaries generated</span>
                  <strong id="heroStatSummaries">‚Äî</strong>
                </div>
                <div class="stat-card" role="listitem">
                  <span class="stat-label">Queued files</span>
                  <strong id="heroStatQueue">0</strong>
                </div>
                <div class="stat-card" role="listitem">
                  <span class="stat-label">Last run</span>
                  <strong id="heroStatLastRun">Not yet</strong>
                </div>
              </div>
            </div>
            <div class="hero-guidance cluster cluster-nowrap" role="list">
              <div class="guidance-card" role="listitem">
                <div class="guidance-icon">üîê</div>
                <div>
                  <strong>Missing API key?</strong>
                  <p class="text-muted">Open <button class="btn-link" data-page="settings" data-panel="models">Settings ‚Üí AI Providers</button> to add one.</p>
                </div>
              </div>
              <div class="guidance-card" role="listitem">
                <div class="guidance-icon">üß†</div>
                <div>
                  <strong>Need combined insights?</strong>
                  <p class="text-muted">Enable "Combine files" below to merge up to 3 files into one summary.</p>
                </div>
              </div>
              <div class="guidance-card" role="listitem">
                <div class="guidance-icon">üìö</div>
                <div>
                  <strong>New to Squailor?</strong>
                  <p class="text-muted">Browse the <button class="btn-link" data-page="history">History</button> view for recent runs or open <button class="btn-link" data-page="settings" data-panel="about">About</button> to learn more.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="home-layout">
            <div class="home-options stack-md">
              <div class="options-grid">
                <!-- Summary Length -->
                <div class="option-card">
                  <div class="option-card-header">
                    <div class="option-meta">
                      <div class="option-icon">ÔøΩ</div>
                      <div class="stack-xs">
                        <span class="option-eyebrow">Output length</span>
                        <h3>Summary depth</h3>
                        <p class="option-description">Control how brief or detailed your summaries should be.</p>
                      </div>
                    </div>
                  </div>
                  <div class="option-card-body">
                    <div class="option-group" role="radiogroup" aria-label="Summary length">
                      <label class="option-choice">
                        <input type="radio" name="summaryType" value="short" id="modeShort">
                        <span class="choice-title">Short</span>
                        <span class="choice-desc">Quick bullets</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="summaryType" value="normal" id="modeNormal" checked>
                        <span class="choice-title">Normal</span>
                        <span class="choice-desc">Balanced detail</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="summaryType" value="longer" id="modeLonger">
                        <span class="choice-title">Longer</span>
                        <span class="choice-desc">Deep dives</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Response Tone -->
                <div class="option-card">
                  <div class="option-card-header">
                    <div class="option-meta">
                      <div class="option-icon">üéØ</div>
                      <div class="stack-xs">
                        <span class="option-eyebrow">Tone</span>
                        <h3>Voice & personality</h3>
                        <p class="option-description">Match the summary tone to your audience.</p>
                      </div>
                    </div>
                  </div>
                  <div class="option-card-body">
                    <div class="option-group" role="radiogroup" aria-label="Response tone">
                      <label class="option-choice">
                        <input type="radio" name="responseTone" value="casual" id="toneCasual" checked>
                        <span class="choice-title">Casual</span>
                        <span class="choice-desc">Friendly & warm</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="responseTone" value="formal" id="toneFormal">
                        <span class="choice-title">Formal</span>
                        <span class="choice-desc">Academic clarity</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="responseTone" value="informative" id="toneInformative">
                        <span class="choice-title">Informative</span>
                        <span class="choice-desc">Factual & neutral</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="responseTone" value="eli5" id="toneEli5">
                        <span class="choice-title">ELI5</span>
                        <span class="choice-desc">Explain simply</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Summary Style -->
                <div class="option-card">
                  <div class="option-card-header">
                    <div class="option-meta">
                      <div class="option-icon">üìù</div>
                      <div class="stack-xs">
                        <span class="option-eyebrow">Format</span>
                        <h3>Delivery style</h3>
                        <p class="option-description">Pick a structure that fits how you review notes.</p>
                      </div>
                    </div>
                  </div>
                  <div class="option-card-body">
                    <div class="option-group" role="radiogroup" aria-label="Summary style">
                      <label class="option-choice">
                        <input type="radio" name="summaryStyle" value="teaching" id="styleTeaching" checked>
                        <span class="choice-title">Teaching</span>
                        <span class="choice-desc">Sectioned overview</span>
                      </label>
                      <label class="option-choice">
                        <input type="radio" name="summaryStyle" value="notes" id="styleNotes">
                        <span class="choice-title">Notes</span>
                        <span class="choice-desc">Dense bullet list</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Model Settings -->
                <div class="option-card">
                  <div class="option-card-header">
                    <div class="option-meta">
                      <div class="option-icon">‚öôÔ∏è</div>
                      <div class="stack-xs">
                        <span class="option-eyebrow">AI settings</span>
                        <h3>Models & preferences</h3>
                        <p class="option-description">Choose the provider, enable OCR, and combine files when needed.</p>
                      </div>
                    </div>
                  </div>
                  <div class="option-card-body">
                    <div class="settings-form">
                      <div class="setting-group">
                        <label for="modelSelect" class="setting-label">AI Model</label>
                        <div class="model-select-row">
                          <select id="modelSelect" class="modern-select">
                            <option value="">Loading models...</option>
                          </select>
                          <button type="button" class="btn btn-ghost btn-small" data-page="settings" data-panel="models">Manage</button>
                        </div>
                        <p id="currentProviderLabel" class="setting-hint">Current provider: Loading...</p>
                      </div>
                      <div class="setting-switchboard">
                        <label class="setting-toggle">
                          <input type="checkbox" id="processImagesToggle" checked>
                          <div>
                            <span class="toggle-title">Analyze images (OCR)</span>
                            <span class="toggle-desc">Extract diagrams, slides, and scans automatically.</span>
                          </div>
                        </label>
                        <label class="setting-toggle">
                          <input type="checkbox" id="combinedToggle">
                          <div>
                            <span class="toggle-title">Combine files</span>
                            <span class="toggle-desc" id="combinedHelperLabel">Limit 3 files; best for multi-part lectures.</span>
                          </div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="home-upload">
              <div class="upload-card surface-raised stack-md">
                <div id="uploadArea" class="upload-zone stack-sm" role="button" tabindex="0" aria-label="Drop files here">
                  <div class="upload-visual">
                    <svg class="upload-icon" width="80" height="80" viewBox="0 0 96 96" fill="none">
                      <circle cx="48" cy="48" r="44" stroke="url(#uploadGrad)" stroke-width="2" stroke-dasharray="6 8" opacity="0.6"/>
                      <path d="M48 28v40M28 48h40" stroke="url(#uploadGrad)" stroke-width="3" stroke-linecap="round" opacity="0.8"/>
                      <defs>
                        <linearGradient id="uploadGrad" x1="0" y1="0" x2="96" y2="96">
                          <stop offset="0%" stop-color="#667eea" />
                          <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                      </defs>
                    </svg>
                  </div>
                  <div class="upload-text stack-xs">
                    <h2 class="text-h2">Drop files here</h2>
                    <p class="text-muted">or click to browse</p>
                    <div class="upload-hints inline-meta">
                      <span class="chip">PDF</span>
                      <span class="chip">PPTX</span>
                      <span class="chip">DOCX</span>
                    </div>
                  </div>
                </div>

                <div class="upload-actions cluster">
                  <button id="selectFiles" class="btn btn-secondary">
                    <span>üìÅ Browse files</span>
                  </button>
                  <button class="btn btn-ghost" id="openRecentDocs">History</button>
                </div>

                <div id="fileList" class="file-list stack-sm" aria-live="polite"></div>

                <footer class="upload-footer">
                  <div class="footer-stats">
                    <div class="stat">
                      <span class="stat-label">Files</span>
                      <strong id="queueCount">0</strong>
                    </div>
                    <div class="stat">
                      <span class="stat-label">Tokens</span>
                      <strong id="queueTokens">‚Äî</strong>
                    </div>
                    <div class="stat" id="costEstimate" hidden>
                      <span class="stat-label">Est. Cost</span>
                      <strong id="queueCost">‚Äî</strong>
                    </div>
                  </div>
                  <button id="processFiles" class="btn btn-primary btn-large" disabled>
                    <span>üöÄ Generate summaries</span>
                  </button>
                </footer>
              </div>
            </div>
          </div>

          <section id="resultsSection" class="results-section" aria-live="polite" hidden>
            <header class="results-header">
              <h3>‚ú® Summary results</h3>
              <p>Review, share, or export your generated summaries.</p>
            </header>
            <div id="results" class="results-grid"></div>
          </section>
        </section>

  <section id="historyPage" class="page" aria-labelledby="historyTitle" hidden>
          <div class="page-heading">
            <div>
              <h2 id="historyTitle">Summary history</h2>
              <p class="page-subtitle">Search, filter, and revisit previous summaries.</p>
            </div>
            <div class="page-meta">
              <span class="meta-chip" id="totalSummaries">0 summaries</span>
              <span class="meta-chip" id="totalDocuments">0 documents</span>
            </div>
          </div>

          <div class="history-layout">
            <aside class="history-sidebar" aria-label="History filters">
              <div class="history-card">
                <label class="form-label" for="historySearch">Search</label>
                <input id="historySearch" class="modern-input" type="search" placeholder="Search summaries..." autocomplete="off">
              </div>
              <div class="history-card">
                <div class="history-card-header">
                  <h4>Quick filters</h4>
                  <button id="clearHistory" class="btn btn-ghost btn-small">Clear all</button>
                </div>
                <div class="filter-chips" id="historyFilters"></div>
              </div>
              <div class="history-card">
                <h4>Summary types</h4>
                <div class="filter-list" id="historyTypes"></div>
              </div>
              <div class="history-card">
                <h4>Tones & styles</h4>
                <div class="filter-list" id="historyTones"></div>
              </div>
            </aside>

            <div class="history-feed">
              <div id="historyList" class="history-list" aria-live="polite"></div>
              <div id="emptyHistory" class="empty-state" hidden>
                <div class="empty-illustration">üìù</div>
                <h3>No history yet</h3>
                <p>Upload a document on the home workspace to get started.</p>
                <button class="btn btn-outline" data-page="home">Go to workspace</button>
              </div>
            </div>
          </div>
        </section>

  <section id="summaryViewPage" class="page" aria-labelledby="summaryViewHeading" hidden>
          <div class="page-heading">
            <div>
              <button class="btn btn-ghost back-button" id="backFromSummary">‚Üê Back</button>
              <h2 id="summaryViewHeading">Summary</h2>
              <p id="summaryViewMeta" class="page-subtitle">Loading...</p>
            </div>
            <div class="summary-meta-chips" id="summaryMetaChips"></div>
          </div>

          <div class="summary-workspace" id="summarySplit">
            <aside class="workspace-panel toc-panel" id="tocSidebar" hidden>
              <div class="panel-header">
                <h3>Outline</h3>
                <button class="icon-btn" id="tocCloseBtn" title="Close outline">‚úñÔ∏è</button>
              </div>
              <div class="panel-body">
                <input id="tocFilter" class="modern-input" type="text" placeholder="Filter sections..." autocomplete="off">
                <nav id="tocList" class="toc-list"></nav>
              </div>
            </aside>

            <div class="panel-resizer" id="tocResizer" hidden></div>

            <article class="workspace-panel summary-panel">
              <header class="summary-panel-header">
                <div class="summary-view-info">
                  <div class="summary-view-icon">‚ú®</div>
                  <div>
                    <h3>AI generated summary</h3>
                    <p id="summaryViewStats">Loading...</p>
                  </div>
                </div>
                <div class="summary-quick-actions">
                  <button class="btn btn-ghost" id="openTocBtn" aria-controls="tocSidebar" aria-expanded="false">‚ò∞ Outline</button>
                  <button class="btn btn-outline btn-small" id="copySummaryView">Copy</button>
                  <button class="btn btn-outline btn-small" id="exportSummaryMD">Export MD</button>
                  <button class="btn btn-outline btn-small" id="exportSummaryTXT">Export TXT</button>
                  <button class="btn btn-outline btn-small" id="shareSummaryView">Share</button>
                  <button class="btn btn-primary btn-small" id="openQaBtn" aria-controls="qaSidebar" aria-expanded="false">üí¨ Ask AI</button>
                </div>
              </header>
              <div class="summary-panel-body">
                <div class="markdown-content" id="summaryViewContent">
                  <div class="viewer-loading">Loading summary...</div>
                </div>
              </div>
            </article>

            <div class="panel-resizer" id="qaResizer" hidden></div>

            <aside class="workspace-panel qa-panel" id="qaSidebar" hidden>
              <div class="panel-header">
                <h3>Chat about this summary</h3>
                <button class="icon-btn" id="qaCloseBtn" title="Close chat">‚úñÔ∏è</button>
              </div>
              <div id="qaTranscript" class="qa-transcript"></div>
              <div class="qa-input-row">
                <input id="qaInput" class="modern-input" type="text" placeholder="Ask a question about the summary..." autocomplete="off">
                <button id="qaSendBtn" class="btn btn-primary">Ask</button>
              </div>
              <div id="qaStatus" class="status-message" hidden role="status" aria-live="polite"></div>
              <div class="panel-resizer qa-edge" id="qaResizerRight"></div>
            </aside>
          </div>
        </section>

  <section id="settingsPage" class="page" aria-labelledby="settingsHeading" hidden>
          <div class="settings-layout">
            <aside class="settings-sidebar" aria-label="Settings navigation">
              <div class="settings-profile">
                <div class="avatar">SQ</div>
                <div class="profile-meta">
                  <strong>Squailor</strong>
                  <span>AI Summarizer</span>
                </div>
              </div>
              <nav class="settings-nav" role="tablist" aria-label="Settings sections">
                <p class="nav-group">App</p>
                <button id="tab-models" class="settings-nav-item active" data-panel="models" role="tab" aria-selected="true" aria-controls="panel-models">ü§ñ AI Providers</button>
                <button id="tab-image" class="settings-nav-item" data-panel="image" role="tab" aria-selected="false" aria-controls="panel-image" tabindex="-1">üñºÔ∏è Image Settings</button>
                <button id="tab-appearance" class="settings-nav-item" data-panel="appearance" role="tab" aria-selected="false" aria-controls="panel-appearance" tabindex="-1">üé® Appearance</button>
                <button id="tab-storage" class="settings-nav-item" data-panel="storage" role="tab" aria-selected="false" aria-controls="panel-storage" tabindex="-1">üíæ Storage</button>
                <button id="tab-updates" class="settings-nav-item" data-panel="updates" role="tab" aria-selected="false" aria-controls="panel-updates" tabindex="-1">‚¨ÜÔ∏è Updates <span id="updateReadyBadge" class="meta-badge" style="display:none; margin-left:6px;">Update ready</span></button>
                <button id="tab-about" class="settings-nav-item" data-panel="about" role="tab" aria-selected="false" aria-controls="panel-about" tabindex="-1">‚ÑπÔ∏è About</button>
                <p class="nav-group">Privacy</p>
                <button id="tab-privacy" class="settings-nav-item" data-panel="privacy" role="tab" aria-selected="false" aria-controls="panel-privacy" tabindex="-1">üîí Privacy</button>
              </nav>
            </aside>

            <section class="settings-content">
              <header class="settings-content-header">
                <div>
                  <h2 id="settingsSectionTitle">AI Providers</h2>
                  <p id="settingsSectionSubtitle">Configure your AI provider credentials.</p>
                </div>
                <div class="settings-actions">
                  <button id="settingsHeaderAction" class="btn btn-primary" hidden></button>
                </div>
              </header>

              <div class="settings-panels" id="settingsPanels">
                <div id="panel-models" class="settings-panel active" role="tabpanel" aria-labelledby="tab-models">
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">ü§ñ</div>
                      <div>
                        <h3>AI provider configuration</h3>
                        <p>Choose your AI provider and configure API credentials.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="form-group">
                        <label class="form-label" for="providerSelect">AI provider</label>
                        <select id="providerSelect" class="modern-select">
                          <option value="openrouter">OpenRouter</option>
                          <option value="openai">OpenAI</option>
                          <option value="anthropic">Anthropic</option>
                          <option value="google">Google (Gemini)</option>
                          <option value="cohere">Cohere</option>
                          <option value="groq">Groq</option>
                          <option value="mistral">Mistral</option>
                          <option value="xai">xAI</option>
                          <option value="azure-openai">Azure OpenAI</option>
                          <option value="custom-openai">Custom OpenAI-compatible</option>
                        </select>
                        <p class="form-helper">Provider settings here apply across the app.</p>
                      </div>

                      <div class="form-group">
                        <label class="form-label" for="providerApiKey">API key</label>
                        <div class="input-with-button">
                          <input type="password" id="providerApiKey" class="modern-input" placeholder="Enter API key..." autocomplete="off">
                          <button id="toggleProviderKey" class="icon-button" title="Show or hide API key">üëÅÔ∏è</button>
                        </div>
                        <p class="form-helper" id="providerKeyHelper">Your key is encrypted locally. Leave blank to keep your saved key.</p>
                      </div>

                      <div class="form-group" id="providerConfigFields">
                        <!-- Provider-specific fields will render here -->
                      </div>

                      <div class="button-row">
                        <button id="testProviderBtn" class="btn btn-outline">Test connection</button>
                        <button id="saveProviderBtn" class="btn btn-primary">Save settings</button>
                        <button id="deleteProviderKeyBtn" class="btn btn-ghost">Delete saved key</button>
                      </div>
                      <div id="providerKeyStatus" class="status-message" style="margin-top: 8px;" role="status" aria-live="polite"></div>
                    </div>
                  </article>
                </div>

                <div id="panel-image" class="settings-panel" role="tabpanel" aria-labelledby="tab-image" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üñºÔ∏è</div>
                      <div>
                        <h3>Image handling</h3>
                        <p>Control OCR usage and combined summary limits.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="form-group">
                        <label for="maxImagesInput" class="form-label">Max images per document</label>
                        <input type="number" id="maxImagesInput" class="modern-input" min="0" max="10">
                        <p class="form-helper">Lower this to reduce API calls and processing cost.</p>
                      </div>
                      <div class="form-group">
                        <label for="maxCombinedInput" class="form-label">Max files to combine</label>
                        <input type="number" id="maxCombinedInput" class="modern-input" min="1" max="10">
                        <p class="form-helper">Caps how many files run when "Combine" is enabled.</p>
                      </div>
                      <button id="saveMaxImages" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        <span>Save settings</span>
                      </button>
                      <div id="maxImagesStatus" class="status-message" role="status" aria-live="polite"></div>
                    </div>
                  </article>
                </div>

                <div id="panel-appearance" class="settings-panel" role="tabpanel" aria-labelledby="tab-appearance" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üé®</div>
                      <div>
                        <h3>Appearance</h3>
                        <p>Switch between system, dark, light, or high contrast themes.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="theme-selector">
                        <button class="theme-option" data-theme="system">
                          <div class="theme-preview light"></div>
                          <span>System</span>
                        </button>
                        <button class="theme-option" data-theme="dark">
                          <div class="theme-preview dark"></div>
                          <span>Dark</span>
                        </button>
                        <button class="theme-option" data-theme="light">
                          <div class="theme-preview light"></div>
                          <span>Light</span>
                        </button>
                        <button class="theme-option" data-theme="high-contrast">
                          <div class="theme-preview high-contrast"></div>
                          <span>High Contrast</span>
                        </button>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-storage" class="settings-panel" role="tabpanel" aria-labelledby="tab-storage" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üíæ</div>
                      <div>
                        <h3>Storage location</h3>
                        <p>Choose where Squailor stores your documents.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="storage-options">
                        <label class="storage-option">
                          <input type="radio" name="storageLocation" value="appdata" id="storageAppData" checked>
                          <div class="storage-content">
                            <div class="storage-icon">üìÅ</div>
                            <div>
                              <strong>AppData (default)</strong>
                              <span id="appdataPath">Loading...</span>
                            </div>
                          </div>
                        </label>
                        <label class="storage-option">
                          <input type="radio" name="storageLocation" value="local-app" id="storageLocalApp">
                          <div class="storage-content">
                            <div class="storage-icon">üìÇ</div>
                            <div>
                              <strong>Application folder</strong>
                              <span id="localAppPath">Loading...</span>
                            </div>
                          </div>
                        </label>
                      </div>
                      <button id="saveStorageLocation" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        <span>Apply location</span>
                      </button>
                      <div id="storageStatus" class="status-message" role="status" aria-live="polite"></div>
                      <div class="storage-stats">
                        <div><span>Files stored:</span> <strong id="statsFileCount">0</strong></div>
                        <div><span>Total size:</span> <strong id="statsTotalSize">0 MB</strong></div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-updates" class="settings-panel" role="tabpanel" aria-labelledby="tab-updates" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">‚¨ÜÔ∏è</div>
                      <div>
                        <h3>Updates</h3>
                        <p>Manage application updates and installation behavior.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="update-actions">
                        <button id="checkUpdatesBtn" class="btn btn-primary">Check for updates</button>
                        <button id="installUpdateBtn" class="btn btn-success" hidden>Restart & install</button>
                        <button id="applyOnRestartBtn" class="btn btn-outline" hidden>Apply on restart</button>
                        <span id="updateStatus" class="status-inline" role="status" aria-live="polite"></span>
                      </div>
                      <div class="update-info" style="margin-top:12px;display:grid;gap:6px;font-size:13px;">
                        <div><strong>Current version:</strong> <span id="currentVersionValue">Loading...</span></div>
                        <div><strong>Latest available:</strong> <span id="latestVersionValue">‚Äî</span></div>
                        <div class="form-group">
                          <label class="form-label" for="updateProviderSelect">Update source</label>
                          <select id="updateProviderSelect" class="modern-select">
                            <option value="github">GitHub (default)</option>
                            <option value="generic">Custom URL (CDN)</option>
                          </select>
                        </div>
                        <div class="form-group" id="genericUrlRow" style="display:none;">
                          <label class="form-label" for="updateGenericUrlInput">Custom update base URL</label>
                          <input id="updateGenericUrlInput" class="modern-input" type="url" placeholder="https://cdn.example.com/squailor">
                          <p class="form-helper">Point to a directory containing latest.yml and release files.</p>
                        </div>
                        <label class="setting-toggle" style="display:flex;align-items:center;gap:6px;margin-top:4px;">
                          <input type="checkbox" id="autoApplyUpdatesToggle">
                          <span>Auto-apply downloaded updates</span>
                        </label>
                        <div id="updateProgressDetails" style="color:#64748b;min-height:16px;font-size:12px;"></div>
                        <div class="manual-download-row" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;">
                          <button id="manualDownloadBtn" class="btn btn-outline btn-small">Manual download</button>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-about" class="settings-panel" role="tabpanel" aria-labelledby="tab-about" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">‚ÑπÔ∏è</div>
                      <div>
                        <h3>About Squailor</h3>
                        <p>Version details and quick links.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <p>Squailor turns lengthy lectures and PDFs into digestible study material powered by OpenRouter.</p>
                      <div class="info-box">
                        <div class="info-icon">üì¶</div>
                        <div class="info-content">
                          <strong>Current version</strong>
                          <p id="appVersionDisplay">Loading...</p>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>

                <div id="panel-privacy" class="settings-panel" role="tabpanel" aria-labelledby="tab-privacy" hidden>
                  <article class="card">
                    <header class="card-header">
                      <div class="card-icon">üîí</div>
                      <div>
                        <h3>Privacy</h3>
                        <p>Understand how your data is handled.</p>
                      </div>
                    </header>
                    <div class="card-body">
                      <div class="info-box">
                        <div class="info-icon">‚ÑπÔ∏è</div>
                        <div class="info-content">
                          <strong>Local-first promise</strong>
                          <ul>
                            <li>Documents stay on disk in the storage location you choose.</li>
                            <li>API keys are encrypted at rest and can be cleared anytime.</li>
                            <li>Only necessary excerpts are sent to the selected model via OpenRouter.</li>
                          </ul>
                        </div>
                      </div>
                      <hr style="border:none;border-top:1px solid #1f2937;margin:16px 0;opacity:.5;" />
                      <div class="info-box">
                        <div class="info-icon">üß≠</div>
                        <div class="info-content" style="width:100%">
                          <strong>Network diagnostics</strong>
                          <p>Hosts contacted outside the known allowlist are shown here to help identify unexpected network activity.</p>
                          <div class="button-row" style="margin:8px 0;gap:8px;display:flex;flex-wrap:wrap;">
                            <button id="diagRefreshBtn" class="btn btn-outline btn-small">Refresh</button>
                            <button id="diagExportBtn" class="btn btn-outline btn-small">Export</button>
                            <button id="diagClearBtn" class="btn btn-ghost btn-small">Clear</button>
                            <span id="diagCount" class="status-inline"></span>
                          </div>
                          <div id="diagList" class="diagnostics-list" style="max-height:180px;overflow:auto;border:1px solid #1f2937;padding:8px;border-radius:8px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;font-size:12px;"></div>
                        </div>
                      </div>
                    </div>
                  </article>
                </div>
              </div>
            </section>
          </div>
        </section>
        </div>
      </main>
    </div>
  </div>

  <div id="summaryCompleteModal" class="modal" hidden>
    <div class="modal-overlay" role="presentation"></div>
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="summaryModalHeading">
      <header class="modal-header">
  <h2 id="summaryModalHeading">‚ú® Generated summaries</h2>
  <button class="modal-close" data-action="close-summary-modal" aria-label="Close dialog">√ó</button>
      </header>
      <div class="modal-body">
        <p class="modal-description">Your document summaries are ready. Review each card to open the full view.</p>
        <div id="summaryCards" class="summary-cards-grid"></div>
      </div>
      <footer class="modal-footer">
  <button class="btn btn-outline" data-action="close-summary-modal">Close</button>
      </footer>
    </div>
  </div>

  <div id="confirmModal" class="modal" hidden>
    <div class="modal-overlay" role="presentation"></div>
    <div class="modal-content small" role="dialog" aria-modal="true" aria-labelledby="confirmModalBody">
      <div class="modal-body" id="confirmModalBody">Are you sure?</div>
      <footer class="modal-footer">
        <button id="confirmCancelBtn" class="btn btn-outline">Cancel</button>
        <button id="confirmOkBtn" class="btn btn-success">Confirm</button>
      </footer>
    </div>
  </div>

  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="renderer.js"></script>
</body>
</html>

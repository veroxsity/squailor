<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Squailor</title>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        background: linear-gradient(180deg,#0f172a,#020617);
        color: #e6eef8;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      .card {
        text-align: center;
        padding: 28px 32px;
        border-radius: 8px;
        box-shadow: 0 6px 24px rgba(2,6,23,0.6);
        background: rgba(255,255,255,0.03);
        width: 420px;
      }
      h1 { margin: 0 0 8px 0; font-size: 22px; }
      p { margin: 0 0 12px 0; color: #b9c6d9; }
      .loader {
        height: 6px;
        background: rgba(255,255,255,0.06);
        border-radius: 4px;
        overflow: hidden;
      }
      .bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg,#34d399,#60a5fa);
        transition: width 600ms linear;
      }
      .small { font-size: 12px; color: #94a3b8; margin-top: 10px }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Squailor</h1>
      <p>Preparing your AI document summarizer...</p>

      <div class="loader" aria-hidden="true">
        <div class="bar" id="bar"></div>
      </div>

      <div class="small">Loading resources â€” this may take a few seconds</div>
      <div class="small" id="updateMsg" style="margin-top:12px;display:none"></div>
      <div style="margin-top:8px; display:none" id="updateActions">
        <button id="installBtn">Restart and install</button>
      </div>
    </div>

    <script>
      // Animate pseudo-progress until main is ready
      const bar = document.getElementById('bar');
      let progress = 0;
      function tick() {
        progress += Math.random() * 12;
        if (progress > 80) progress = 80; // reserve final progress for actual update/main ready
        bar.style.width = progress + '%';
        setTimeout(tick, 400 + Math.random() * 400);
      }
      tick();

      // Updater bindings (using exposed electronAPI from preload)
      const updateMsg = document.getElementById('updateMsg');
      const updateActions = document.getElementById('updateActions');
      const installBtn = document.getElementById('installBtn');

      if (window.electronAPI) {
        window.electronAPI.onUpdateChecking(() => {
          updateMsg.style.display = 'block';
          updateMsg.textContent = 'Checking for updates...';
        });

        window.electronAPI.onUpdateAvailable((info) => {
          updateMsg.style.display = 'block';
          updateMsg.textContent = `Update available: ${info.version}. Downloading...`;
        });

        window.electronAPI.onUpdateProgress((progress) => {
          updateMsg.style.display = 'block';
          updateMsg.textContent = `Downloading update: ${Math.floor(progress.percent)}%`;
          bar.style.width = Math.min(90, Math.floor(progress.percent)) + '%';
        });

        window.electronAPI.onUpdateDownloaded((info) => {
          updateMsg.textContent = `Update ${info.version} ready.`;
          bar.style.width = '100%';
          updateActions.style.display = 'block';
        });

        window.electronAPI.onUpdateError((err) => {
          updateMsg.style.display = 'block';
          updateMsg.textContent = `Update failed: ${err && err.message ? err.message : err}`;
        });

        installBtn.addEventListener('click', () => {
          window.electronAPI.installUpdate(true);
        });
      }
    </script>
  </body>
</html>
